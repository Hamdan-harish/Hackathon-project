<!DOCTYPE html>
<html>
<head>
<title>My Complaints — SmartCampus Fix</title>

<style>
:root{
  --bg:#0B1220;
  --panel:#0F172A;
  --card:#0F1B33;
  --border:#1F2A44;
  --blue:#3B82F6;
  --blue-dark:#2563EB;
  --green:#22C55E;
  --text:#E5E7EB;
  --muted:#94A3B8;
}

/* GLOBAL */
body{
  background:linear-gradient(180deg,#0B1220,#060B14);
  color:var(--text);
  font-family:Inter,Arial;
  margin:0;
  overflow-x:hidden;
  animation:fadeIn 0.8s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* NAVBAR */
.navbar{
  background:#0A1222cc;
  backdrop-filter:blur(6px);
  border-bottom:1px solid var(--border);
  padding:14px 22px;
  display:flex;justify-content:space-between;align-items:center;
}
.nav-left{font-size:18px;font-weight:600}
.nav-right a{
  color:var(--muted);
  margin-right:14px;
  text-decoration:none;
  transition:.25s;
}
.nav-right a:hover{color:white}
.nav-right button{
  background:var(--blue-dark);
  border:none;border-radius:9px;
  padding:8px 12px;
  color:white;
  cursor:pointer;
  transition:.25s;
}
.nav-right button:hover{transform:translateY(-1px);background:#1d4ed8}

/* LAYOUT */
.container{max-width:900px;margin:28px auto;padding:0 14px}
h3{margin:6px 0 10px}

/* CARD BASE */
.card{
  background:#0F162dcc;
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
  animation:cardPop .45s ease;
}
@keyframes cardPop{from{opacity:0;transform:translateY(8px)}}

/* ANIMATED INPUTS */
input,textarea,select{
  width:100%;
  padding:12px;
  background:#0B1328;
  border:1px solid #23324e;
  border-radius:12px;
  color:white;
  transition:.25s;
}
input:focus,textarea:focus,select:focus{
  outline:none;
  box-shadow:0 0 0 2px #2563eb66;
  transform:translateY(-1px);
}
textarea{min-height:90px}

/* BUTTON */
button.primary{
  background:linear-gradient(90deg,#3B82F6,#2563EB);
  border:none;border-radius:12px;
  padding:11px 14px;
  color:white;
  cursor:pointer;
  transition:.25s;
}
button.primary:hover{filter:brightness(1.1);transform:translateY(-1px)}
button.primary:active{transform:scale(.98)}

/* TIMELINE TAGS */
.timeline{display:flex;gap:8px;margin-top:10px}
.step{
  padding:6px 10px;border-radius:10px;
  background:#1b2644;color:#9ca3af;
  transition:.25s;
}
.step.active{background:var(--blue-dark);color:white}

/* COMPLAINT CARDS ANIMATION */
.complaint{
  transition:.3s;
}
.complaint:hover{
  transform:translateY(-3px);
  box-shadow:0 16px 35px rgba(0,0,0,.35);
}

/* SUBTLE TEXT */
.subtle{color:var(--muted);font-size:13px}
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <div class="nav-left">SmartCampus Fix</div>
  <div class="nav-right">
    <a href="index.html">Home</a>
    <a href="analytics.html">Analytics</a>
    <a href="admin.html">Admin</a>
    <button id="logoutBtn">Logout</button>
  </div>
</div>


<div class="container">

<h3>Submit Complaint</h3>

<div class="card">
<form id="complaintForm">

  <input id="name" placeholder="Your name" required>
  <input id="title" placeholder="Complaint title" required>
  <textarea id="desc" placeholder="Describe the problem…" required></textarea>
  <input id="location" placeholder="Block / Room / Area">

  <select id="category" required>
    <option value="" disabled selected>Select Category</option>
    <option>Electrical</option><option>Cleaning</option>
    <option>Network</option><option>Maintenance</option><option>Other</option>
  </select>

  <select id="priority" required>
    <option value="" disabled selected>Select Priority</option>
    <option>Low</option><option>Medium</option><option>High</option>
  </select>

  <button class="primary">Submit Complaint</button>
</form>

<p id="msg"></p>
</div>


<h3>My Complaints</h3>
<div id="list"></div>

</div>


<!-- FIREBASE -->
<script type="module">
console.log("SCRIPT LOADED");

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut }
 from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import {
 getFirestore,collection,addDoc,serverTimestamp,
 query,where,orderBy,onSnapshot
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* CONFIG */
const app=initializeApp({
 apiKey:"AIzaSyBT7No8i0VsEpDH-AJzj5UgAi6czE4ojOY",
 authDomain:"my-project-ace79.firebaseapp.com",
 projectId:"my-project-ace79"
});

const auth=getAuth(app);
const db=getFirestore(app);

const form=document.getElementById("complaintForm");
const msg=document.getElementById("msg");
const list=document.getElementById("list");

/* PROTECT PAGE */
onAuthStateChanged(auth,user=>{
 if(!user) window.location.href="login.html";
});

/* SUBMIT */
form.addEventListener("submit",async e=>{
 e.preventDefault();
 const u=auth.currentUser;
 if(!u){msg.innerText="Please login first.";return;}

 await addDoc(collection(db,"complaints"),{
  userId:u.uid,
  name:name.value.trim(),
  title:title.value.trim(),
  description:desc.value.trim(),
  location:location.value.trim(),
  category:category.value,
  priority:priority.value,
  status:"submitted",
  createdAt:serverTimestamp()
 });

 msg.innerText="Complaint submitted ✔";
 form.reset();
});

/* LOAD COMPLAINTS */
onAuthStateChanged(auth,user=>{
 if(!user) return;

 const q=query(
  collection(db,"complaints"),
  where("userId","==",user.uid),
  orderBy("createdAt","desc")
 );

 onSnapshot(q,snap=>{
  list.innerHTML="";
  snap.forEach(d=>{
    const c=d.data();
    list.innerHTML+=`
    <div class="card complaint">
      <h3>${c.title}</h3>
      <p>${c.description}</p>
      <p class="subtle">${c.location}</p>
      <p><b>${c.category}</b> — Priority: <b>${c.priority}</b></p>

      <div class="timeline">
        <div class="step ${c.status!='submitted'?'active':''}">Submitted</div>
        <div class="step ${c.status=='in-progress'||c.status=='resolved'?'active':''}">
          In-Progress
        </div>
        <div class="step ${c.status=='resolved'?'active':''}">Resolved</div>
      </div>
    </div>`;
  });
 });
});

/* LOGOUT */
logoutBtn.onclick=()=>signOut(auth);
</script>

</body>
</html>
