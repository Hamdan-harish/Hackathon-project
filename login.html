<!DOCTYPE html>
<html>
<head>
<title>Login â€” SmartCampus Fix</title>

<style>
*{font-family:'Courier New',monospace}
:root{
  --bg:#0B1220;--card:#101B33;--border:#1F2A44;
  --blue:#3B82F6;--blue-dark:#2563EB;
  --text:#E5E7EB;--muted:#94A3B8;
  --green:#22C55E;--red:#EF4444;
}
body{background:var(--bg);color:var(--text);margin:0}

.wrapper{
  max-width:420px;margin:70px auto;background:var(--card);
  border:1px solid var(--border);border-radius:18px;padding:18px;
  position:relative;top:180px;
}
.title{font-size:40px;font-weight:600;text-align:center;margin-bottom:6px}
.sub{color:var(--muted);font-size:20px;text-align:center;margin-bottom:12px}

button.primary{
  width:100%;padding:11px;border-radius:12px;border:none;
  background:var(--blue);color:white;margin-top:6px;cursor:pointer
}
button.primary:hover{background:var(--blue-dark)}
button.primary:disabled{opacity:.6;cursor:not-allowed}

.msgBox{
  margin-top:12px;padding:10px;border-radius:12px;
  font-size:13px;text-align:center;display:none;
}
.msg-success{background:#062e16;border:1px solid #14532d;color:#a7f3d0}
.msg-error{background:#2a0b0b;border:1px solid #7f1d1d;color:#fecaca}

.demoArea{margin-top:14px;text-align:center;display:none}
.demoBtn{
  width:100%;padding:10px 14px;border-radius:10px;
  border:none;background:#2563eb;color:white;cursor:pointer
}
.studentBtn{
  width:100%;padding:10px 14px;border-radius:10px;
  border:none;background:#22C55E;color:white;margin-top:8px;cursor:pointer
}
</style>
</head>

<body>

<div class="wrapper">
  <div class="title">Campus Login</div>
  <p class="sub">Sign in using your IIIT Kottayam Google account</p>

  <button id="googleBtn" class="primary">Continue with Google</button>

  <div id="msg" class="msgBox"></div>

  <!-- ðŸŽ¯ Mode selection AFTER login -->
  <div id="demoArea" class="demoArea">
    <button id="studentBtn" class="studentBtn">Continue as Student</button>

    <button id="demoAdminBtn" class="demoBtn">
      Continue in Demo Admin Mode
    </button>

    <p style="font-size:12px;color:#9ca3af;margin-top:6px">
      (Temporary admin access for evaluation only)
    </p>
  </div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getAuth, GoogleAuthProvider, signInWithPopup,
  onAuthStateChanged, signOut
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import {
  getFirestore, doc, getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* CONFIG */
const app = initializeApp({
 apiKey:"AIzaSyBT7No8i0VsEpDH-AJzj5UgAi6czE4ojOY",
 authDomain:"my-project-ace79.firebaseapp.com",
 projectId:"my-project-ace79"
});

const auth = getAuth(app);
const db   = getFirestore(app);

const googleBtn = document.getElementById("googleBtn");
const msg       = document.getElementById("msg");
const demoArea  = document.getElementById("demoArea");
const demoBtn   = document.getElementById("demoAdminBtn");
const studentBtn= document.getElementById("studentBtn");

const provider = new GoogleAuthProvider();
const ORG_DOMAIN = "iiitkottayam.ac.in";

/* UI helper */
function showMsg(text,type){
  msg.style.display="block";
  msg.className="msgBox "+(type==="success"?"msg-success":"msg-error");
  msg.innerText=text;
}

/* ---------- LOGIN FLOW ---------- */
googleBtn.onclick = async ()=>{
  showMsg("Opening Google sign-inâ€¦","success");
  googleBtn.disabled=true;

  try{
    const res  = await signInWithPopup(auth,provider);
    const user = res.user;
    const email = user.email||"";
    const domain = email.split("@").pop();

    if(domain !== ORG_DOMAIN){
      showMsg("Login restricted â€” use your IIIT Kottayam email.","error");
      await signOut(auth);
      googleBtn.disabled=false;
      return;
    }

    await setDoc(doc(db,"users",user.uid),{
      name:user.displayName||"", email, role:"student"
    },{merge:true});

    showMsg("Signed in â€” choose a mode below.","success");
    googleBtn.style.display="none";
    demoArea.style.display="block";

  }catch(e){
    showMsg("Login failed â€” please try again.","error");
    googleBtn.disabled=false;
  }
};

/* Stay on page after login */
onAuthStateChanged(auth,user=>{
  if(user){
    googleBtn.style.display="none";
    demoArea.style.display="block";
    showMsg("Signed in â€” choose a mode below.","success");
  }
});

/* Continue as student */
studentBtn.onclick = ()=>{
  location.href="complaints.html";
};

/* ðŸŽ¯ DEMO ADMIN MODE (no role change, just preview) */
demoBtn.onclick = ()=>{
  sessionStorage.setItem("demoAdmin","true");
  location.href="admin.html";
};
</script>

</body>
</html>
